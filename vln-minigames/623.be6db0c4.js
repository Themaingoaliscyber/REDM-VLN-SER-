"use strict";(self["webpackChunkbcc_minigame"]=self["webpackChunkbcc_minigame"]||[]).push([[623],{5623:function(e,i,t){t.r(i),t.d(i,{default:function(){return R}});t(4114),t(8992),t(3949);var o,s,n,l,a,h,d=t(7844),r=(t(9692),Object.defineProperty),c=(e,i,t)=>i in e?r(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,u=(e,i,t)=>(c(e,"symbol"!=typeof i?i+"":i,t),t),p=(e,i,t)=>{if(!i.has(e))throw TypeError("Cannot "+t)},m=(e,i,t)=>(p(e,i,"read from private field"),t?t.call(e):i.get(e)),v=(e,i,t)=>{if(i.has(e))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(e):i.set(e,t)},f=(e,i,t,o)=>(p(e,i,"write to private field"),o?o.call(e,t):i.set(e,t),t),g=(e,i,t,o)=>({set _(o){f(e,i,o,t)},get _(){return m(e,i,o)}});class R{constructor(e){u(this,"config"),v(this,o,void 0),u(this,"initialized",!1),v(this,s,{}),v(this,n,0),v(this,l,0),v(this,a,[]),v(this,h,void 0),u(this,"noop",(()=>{})),this.onInitComplete=e.onInitComplete||this.noop,this.onThemeLoaded=e.onThemeLoaded||this.noop,this.onRollResult=e.onRollResult||this.noop,this.onRollComplete=e.onRollComplete||this.noop,this.onDieRemoved=e.onDieRemoved||this.noop,this.initialized=this.initScene(e)}async initScene(e){this.config=e.options,this.onInitComplete()}resize(){}loadTheme(){return Promise.resolve()}updateConfig(e){Object.assign(this.config,e)}addNonDie(e){console.log("die",e),clearTimeout(m(this,h));const{id:i,value:t,...o}=e,l={id:i,value:t,config:o};m(this,s)[i]=l,m(this,a).push(setTimeout((()=>{this.handleAsleep(l)}),g(this,n)._++*this.config.delay)),f(this,h,setTimeout((()=>{this.onRollComplete()}),500))}add(e){console.log("add die"),this.addNonDie(e)}remove(e){console.log("remove die");const i=m(this,s)[e.id];i.hasOwnProperty("d10Instance")&&(delete m(this,s)[i.d10Instance.id],g(this,l)._--),delete m(this,s)[e.id],g(this,l)._--,this.onDieRemoved(e.rollId)}clear(){!Object.keys(m(this,s)).length&&!m(this,l)||(m(this,a).forEach((e=>clearTimeout(e))),Object.values(m(this,s)).forEach((e=>{e.mesh&&e.mesh.dispose()})),f(this,s,{}),f(this,n,0),f(this,l,0))}async handleAsleep(e){var i,t;if(e.asleep=!0,await d.D.getRollResult(e),e.d10Instance||e.dieParent){if(null!=(i=null==e?void 0:e.d10Instance)&&i.asleep||null!=(t=null==e?void 0:e.dieParent)&&t.asleep){const i=100===e.config.sides?e:e.dieParent,t=10===e.config.sides?e:e.d10Instance;0===t.value&&0===i.value?i.value=100:i.value=i.value+t.value,this.onRollResult({rollId:i.config.rollId,value:i.value})}}else 10===e.config.sides&&0===e.value&&(e.value=10),this.onRollResult({rollId:e.config.rollId,value:e.value});g(this,l)._++}}o=new WeakMap,s=new WeakMap,n=new WeakMap,l=new WeakMap,a=new WeakMap,h=new WeakMap}}]);
//# sourceMappingURL=623.be6db0c4.js.map